<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Skibidi Tower Defense Official Value list</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#050405; --panel:#070607; --card:#0b0b0b; --muted:#cfc9d6; --neon1:#b300ff; --neon2:#ff3bd1; --accent:#7b00e6;
      --g-astral: linear-gradient(135deg,#7f00ff,#00ffd5);
      --g-cosmic: linear-gradient(135deg,#b800e6,#6cedf0);
      --g-divine: linear-gradient(135deg,#ff00c8,#2248ff);
      --g-godly: linear-gradient(135deg,#7b00e6,#6367ff);
      --g-exclusive: linear-gradient(135deg,#00d1ff,#4fe0a3);
      --g-mythic: linear-gradient(135deg,#ff6d68,#ffb86b);
      --g-legendary: linear-gradient(135deg,#ffd54a,#ff7a00);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#fff;font-family:Montserrat,system-ui,Arial,Helvetica,sans-serif;padding:28px;display:flex;flex-direction:column;align-items:center}

    .header{width:100%;max-width:1200px;display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .site-title{font-weight:900;letter-spacing:4px;color:var(--neon2);font-size:20px;text-shadow:0 4px 24px rgba(255,59,209,0.12);}
    .neon-title{background:linear-gradient(90deg,var(--neon1),var(--neon2));-webkit-background-clip:text;background-clip:text;color:transparent}

    .controls{display:flex;gap:12px;align-items:center}
    .search{background:transparent;border:2px solid rgba(255,255,255,0.04);padding:10px 14px;border-radius:8px;color:var(--muted);min-width:320px}
    .sort-row{display:flex;gap:8px;align-items:center;margin-left:8px}
    .sort-btn{padding:8px 10px;border-radius:8px;background:transparent;border:2px solid rgba(255,255,255,0.04);color:var(--muted);font-weight:900;cursor:pointer}
    .sort-btn.active{border-color:var(--neon1);color:var(--neon2);box-shadow:0 6px 20px rgba(123,0,230,0.08)}

    .rarity-row{display:flex;gap:8px;margin:18px 0;flex-wrap:wrap}
    .rar-btn{padding:10px 12px;border-radius:8px;background:transparent;border:2px solid rgba(255,255,255,0.04);color:var(--muted);font-weight:900;cursor:pointer}
    .rar-btn.active{box-shadow:0 6px 28px rgba(123,0,230,0.12), 0 0 24px rgba(255,59,209,0.06);border-color:var(--neon1);color:var(--neon2)}

    .grid{width:100%;max-width:1200px;display:grid;grid-template-columns:repeat(3,1fr);gap:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));border-radius:12px;padding:12px;border:2px solid rgba(255,255,255,0.03);position:relative;overflow:hidden}
    .card::after{content:'';position:absolute;inset:0;border-radius:12px;pointer-events:none;mix-blend-mode:screen;opacity:0.02}

    .card-head{display:flex;gap:12px;align-items:center}
    :root{ --trait-gradient: linear-gradient(90deg,#ff5f6d,#ffc371,#7efc8a,#00d1ff,#7b00e6); }
    .portrait{width:96px;height:96px;border-radius:8px;background:#0a0a0a;border:3px solid rgba(255,255,255,0.04);background-size:cover;background-position:center}
    .portrait.trait-glow{box-shadow:0 12px 60px rgba(123,0,230,0.14), 0 0 30px rgba(255,59,209,0.12) inset; border-color:transparent}
    .trait-col{display:flex;flex-direction:column;gap:10px;height:100%;justify-content:center;align-items:center}
    .trait-col.left{margin-right:8px}
    .trait-col.right{margin-left:8px}
    .trait-btn{width:40px;height:40px;border-radius:50%;background:var(--trait-gradient);border:2px solid rgba(0,0,0,0.4);cursor:pointer;box-shadow:0 8px 20px rgba(123,0,230,0.06);background-size:cover;background-position:center}
    .trait-btn.selected{outline:3px solid rgba(255,255,255,0.06);box-shadow:0 8px 30px rgba(255,59,209,0.12)}
    .se-badge{display:inline-block;padding:6px 10px;border-radius:10px;background:linear-gradient(90deg,#ffd54a,#ff7a00);color:#111;font-weight:900;margin-left:10px;font-size:12px}
    .name{font-weight:900;text-transform:uppercase;letter-spacing:1px;color:var(--neon2);font-size:13px}

    .info-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
    .info-cell{background:rgba(0,0,0,0.16);padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.02);font-weight:900;text-align:center}
    .label{font-size:10px;color:#b8aeda;text-transform:uppercase}
    .value{font-size:14px;margin-top:6px}

    .status-badge{display:inline-block;padding:6px 8px;border-radius:8px;font-weight:900;text-transform:uppercase}
    .status-rising{background:linear-gradient(90deg,#7efc8a,#22c55e);color:#021}
    .status-unstable{background:linear-gradient(90deg,#ff6d68,#ffb86b);color:#111}
    .demand-pill{padding:6px 8px;border-radius:8px;font-weight:900; background:linear-gradient(90deg,#ff6dff,#7b00e6);color:#fff}

    .pagination{display:flex;gap:8px;align-items:center;margin:18px 0}
    .page-btn{padding:8px 10px;border-radius:8px;background:transparent;border:2px solid rgba(255,255,255,0.04);color:var(--muted);font-weight:900;cursor:pointer}

    /* neon outlines per rarity - small accent bar */
    .card.rarity-astral{box-shadow:0 6px 30px rgba(127,0,255,0.06);border-color:rgba(127,0,255,0.18)}
    .card.rarity-cosmic{box-shadow:0 6px 30px rgba(184,0,230,0.06);border-color:rgba(184,0,230,0.18)}
    .card.rarity-divine{box-shadow:0 6px 30px rgba(255,0,200,0.06);border-color:rgba(255,0,200,0.18)}
    .card.rarity-godly{box-shadow:0 6px 30px rgba(123,0,230,0.06);border-color:rgba(123,0,230,0.18)}
    .card.rarity-exclusive{box-shadow:0 6px 30px rgba(0,209,255,0.06);border-color:rgba(0,209,255,0.18)}
    .card.rarity-mythic{box-shadow:0 6px 30px rgba(255,106,104,0.06);border-color:rgba(255,106,104,0.18)}
    .card.rarity-legendary{box-shadow:0 6px 30px rgba(255,213,74,0.06);border-color:rgba(255,213,74,0.18)}

    /* stronger rarity background tint */
    .card.rarity-astral::after{background:var(--g-astral);opacity:0.06}
    .card.rarity-cosmic::after{background:var(--g-cosmic);opacity:0.06}
    .card.rarity-divine::after{background:var(--g-divine);opacity:0.06}
    .card.rarity-godly::after{background:var(--g-godly);opacity:0.06}
    .card.rarity-exclusive::after{background:var(--g-exclusive);opacity:0.06}
    .card.rarity-mythic::after{background:var(--g-mythic);opacity:0.06}
    .card.rarity-legendary::after{background:var(--g-legendary);opacity:0.06}

    @media (max-width:1000px){.grid{grid-template-columns:repeat(2,1fr)}.search{min-width:160px}}
    @media (max-width:600px){.grid{grid-template-columns:1fr}.header{flex-direction:column;align-items:flex-start}.controls{width:100%;justify-content:space-between}}
  </style>
</head>
<body>
  <div class="header">
    <div class="site-title neon-title">Skibidi Tower Defense Official Value list</div>
    <div class="controls">
      <input id="search" class="search" placeholder="Search units..." />
      <div class="sort-row">
        <button class="sort-btn active" data-sort="rarity" id="sort-rarity">Rarity</button>
        <button class="sort-btn" data-sort="value-desc" id="sort-value">Value ↓</button>
        <button class="sort-btn" id="open-calculator">Calculator</button>
      </div>
    </div>
  </div>

  <div class="rarity-row" id="rarityRow"></div>
  <!-- Calculator (hidden by default) -->
  <div id="calculator-root" style="width:100%;max-width:1200px;margin-top:18px;display:none">
    <div style="display:flex;gap:12px;justify-content:space-between;align-items:center;margin-bottom:12px">
      <div style="font-weight:900">Calculator</div>
      <div><button class="sort-btn" id="calc-close">Close</button></div>
    </div>
    <div style="display:flex;gap:12px">
      <div style="flex:1;padding:12px;background:rgba(0,0,0,0.16);border-radius:8px">
        <div style="font-weight:900;margin-bottom:8px">Your Value</div>
        <div id="left-items" style="min-height:120px;display:flex;gap:8px;flex-wrap:wrap"></div>
        <div id="left-total" style="margin-top:8px;font-weight:900">Total: 0</div>
      </div>
      <div style="flex:1;padding:12px;background:rgba(0,0,0,0.16);border-radius:8px">
        <div style="font-weight:900;margin-bottom:8px">Their Value</div>
        <div id="right-items" style="min-height:120px;display:flex;gap:8px;flex-wrap:wrap"></div>
        <div id="right-total" style="margin-top:8px;font-weight:900">Total: 0</div>
      </div>
    </div>
  </div>
  <div class="grid" id="grid"></div>
  <div class="pagination" id="pagination"></div>

  <script src="skibidi-td-data.js"></script>
  <script>
  (function(){
    if(typeof unitDatabase==='undefined'){ document.getElementById('grid').innerText='unitDatabase missing (place skibidi-td-data.js alongside this file)'; return }
    const rarities = ['All','Astral','Cosmic','Divine','Godly','Exclusive','Mythic','Legendary'];
    const unitKeys = Object.keys(unitDatabase).sort((a,b)=> (unitDatabase[a].name||'').localeCompare(unitDatabase[b].name||''));
    // trait image ids (Google Drive thumbnails)
    const traitImages = {
      'Grandmaster': '1C1TJwQXNqvM0r9g32fq5_j3r6g-B01DF',
      'Master': '1oaTPE4cr2UyiHDX_nDo41efOyUboWoMV',
      'Sniper': '1Y4AdKn1XXEKxVMRgzZYANJLbjRuuHobJ',
      'Superpayday': '1T1DtpHB_cf4xx1ynNjjzOWXzCeC_bAbk'
    };
    // lowercase lookup for robustness
    const traitImagesLower = Object.keys(traitImages).reduce((acc,k)=>{ acc[k.toLowerCase()]=traitImages[k]; return acc },{});
    const grid = document.getElementById('grid');
    const rarityRow = document.getElementById('rarityRow');
    const search = document.getElementById('search');
    const pagination = document.getElementById('pagination');
    const calcRoot = document.getElementById('calculator-root');
    const openCalcBtn = document.getElementById('open-calculator');
    const calcCloseBtn = document.getElementById('calc-close');

    // calculator state
    let leftCalc = [], rightCalc = [];
    // selected trait per unit (keeps view choice)
    const selectedTraits = {};

    let filter='All'; let q=''; let page=1; const perPage=9;
    let currentSort = 'rarity';

    function makeRarityButtons(){ rarityRow.innerHTML = rarities.map(r=>`<button class="rar-btn" data-r="${r.toLowerCase()}">${r}</button>`).join('');
      rarityRow.querySelectorAll('.rar-btn').forEach(b=>{ b.addEventListener('click', ()=>{ rarityRow.querySelectorAll('.rar-btn').forEach(x=>x.classList.remove('active')); b.classList.add('active'); filter=b.innerText; page=1; render(); }) });
      // set All active
      const all = rarityRow.querySelector('[data-r="all"]'); if(all) all.classList.add('active');
    }

    // sort button wiring
    document.getElementById('sort-rarity').addEventListener('click', function(){ document.querySelectorAll('.sort-btn').forEach(b=>b.classList.remove('active')); this.classList.add('active'); currentSort='rarity'; render(); });
    document.getElementById('sort-value').addEventListener('click', function(){ document.querySelectorAll('.sort-btn').forEach(b=>b.classList.remove('active')); this.classList.add('active'); currentSort='value-desc'; render(); });

    // calculator open/close
    if(openCalcBtn) openCalcBtn.addEventListener('click', ()=>{ calcRoot.style.display='block'; document.querySelector('.rarity-row').style.display='none'; document.querySelector('.header').style.display='none'; render(); });
    if(calcCloseBtn) calcCloseBtn.addEventListener('click', ()=>{ calcRoot.style.display='none'; document.querySelector('.rarity-row').style.display='flex'; document.querySelector('.header').style.display='flex'; render(); });

    function parseValue(v){ if(!v && v!==0) return 0; const s=String(v).replace(/[\$\,\s]/g,''); const m=s.match(/(\d+(?:\.\d+)?)([kKmM])?/); if(m){let n=parseFloat(m[1]); const u=m[2]; if(u){ if(u.toLowerCase()==='k') n*=1e3; if(u.toLowerCase()==='m') n*=1e6;} return n} const f=s.match(/\d+(?:\.\d+)?/); return f?parseFloat(f[0]):0 }

    function abbr(n){ if(!isFinite(n)||n===0) return '0'; if(n>=1e6) return (n/1e6).toFixed(2)+'M'; if(n>=1e3) return (n/1e3).toFixed(2)+'K'; return Math.round(n).toLocaleString(); }

    function demandClass(d){ if(!d) return 'Low'; const m=String(d).match(/(\d+)/); const v=m?Number(m[1]):0; if(v>=8) return 'High'; if(v>=4) return 'Mid'; return 'Low' }

    function render(){
      q = (search.value||'').trim().toLowerCase();
      let keys = unitKeys.filter(k=>{
        const u=unitDatabase[k];
        if(!u) return false;
        if(filter.toLowerCase()!=='all'){
          if((u.rarity||'').toLowerCase()!==filter.toLowerCase()) return false;
        }
        if(q && !(u.name||'').toLowerCase().includes(q)) return false;
        return true;
      });

      // sorting: apply to the full keys list before pagination
      if(currentSort === 'value-desc'){
        keys.sort((a,b)=> parseValue(unitDatabase[b].baseStats && unitDatabase[b].baseStats.value) - parseValue(unitDatabase[a].baseStats && unitDatabase[a].baseStats.value));
      } else if(currentSort === 'rarity'){
        const order = ['astral','cosmic','divine','godly','exclusive','mythic','legendary'];
        keys.sort((a,b)=>{
          const ra = (unitDatabase[a].rarity||'').toLowerCase();
          const rb = (unitDatabase[b].rarity||'').toLowerCase();
          const ia = order.indexOf(ra);
          const ib = order.indexOf(rb);
          if(ia !== ib) return ia - ib; // lower index first
          // same rarity: sort by value desc
          return parseValue(unitDatabase[b].baseStats && unitDatabase[b].baseStats.value) - parseValue(unitDatabase[a].baseStats && unitDatabase[a].baseStats.value);
        });
      }

      const total = Math.max(1, Math.ceil(keys.length/perPage));
      if(page>total) page=total;
      const start = (page-1)*perPage; const pageKeys = keys.slice(start,start+perPage);

      grid.innerHTML = pageKeys.map(k=>{
        const u = unitDatabase[k];
        const portrait = u.unitId ? `url('https://corsproxy.io/?https://drive.google.com/thumbnail?id=${u.unitId}')` : '';
        const rarityClass = 'rarity-'+((u.rarity||'') .toLowerCase().replace(/\s+/g,'-'));
        // trait selection: if a trait is selected for this unit, use it
        const selTrait = selectedTraits[k] || 'base';
        const traitObj = (selTrait !== 'base' && u.traits && u.traits[selTrait]) ? u.traits[selTrait] : null;
        const displayVal = traitObj && traitObj.value ? traitObj.value : (u.baseStats && u.baseStats.value ? u.baseStats.value : '0');
        const displayStatus = traitObj && traitObj.status ? traitObj.status : (u.baseStats && u.baseStats.status ? u.baseStats.status : 'Unknown');
        const displayDemand = traitObj && traitObj.demand ? traitObj.demand : (u.baseStats && u.baseStats.demand ? u.baseStats.demand : '0/10');
        const portraitClass = selTrait !== 'base' ? 'portrait trait-glow' : 'portrait';

        // build trait buttons: up to 4 traits, 2 on left and 2 on right
        let leftTraitHtml = '';
        let rightTraitHtml = '';
        if(u.traits && typeof u.traits === 'object'){
          const tkeys = Object.keys(u.traits).slice(0,4); // limit
          const left = tkeys.slice(0,2);
          const right = tkeys.slice(2,4);
          const gradient = 'linear-gradient(90deg,#ff5f6d,#ffc371,#7efc8a,#00d1ff,#7b00e6)';

          leftTraitHtml = `<div class="trait-col left">` + left.map(t=>{
            const imgId = traitImages[t] || traitImagesLower[String(t).toLowerCase()] || '';
            const bg = imgId ? `background-image:url('https://corsproxy.io/?https://drive.google.com/thumbnail?id=${imgId}'), ${gradient};background-size:cover,cover;background-position:center,center` : '';
            const selClass = selectedTraits[k] === t ? ' selected' : '';
            return `<div class="trait-btn${selClass}" data-unit="${k}" data-trait="${t}" title="${t}" style="${bg}"></div>`;
          }).join('') + `</div>`;

          rightTraitHtml = `<div class="trait-col right">` + right.map(t=>{
            const imgId = traitImages[t] || traitImagesLower[String(t).toLowerCase()] || '';
            const bg = imgId ? `background-image:url('https://corsproxy.io/?https://drive.google.com/thumbnail?id=${imgId}'), ${gradient};background-size:cover,cover;background-position:center,center` : '';
            const selClass = selectedTraits[k] === t ? ' selected' : '';
            return `<div class="trait-btn${selClass}" data-unit="${k}" data-trait="${t}" title="${t}" style="${bg}"></div>`;
          }).join('') + `</div>`;
        }

        return `
          <div class="card ${rarityClass}" data-key="${k}">
            <div class="card-head">
              ${leftTraitHtml}
              <div class="${portraitClass}" style="background-image:${portrait}"></div>
              ${rightTraitHtml}
              <div style="flex:1">
                <div style="display:flex;align-items:center;gap:8px">
                  <div class="name">${(u.name||'Unnamed').toUpperCase()}</div>
                  ${ (u.secondEdition && String(u.secondEdition).toLowerCase() === 'yes') ? '<div class="se-badge">2ND</div>' : '' }
                </div>
              </div>
            </div>
            <div class="info-grid">
              <div class="info-cell">
                <div class="label">Value</div>
                <div class="value">${String(displayVal)}</div>
              </div>
              <div class="info-cell">
                <div class="label">Demand</div>
                <div class="value"><span class="demand-pill">${String(displayDemand)}</span></div>
              </div>
              <div class="info-cell" style="grid-column:1 / -1">
                <div class="label">Status</div>
                <div style="margin-top:8px"><span class="status-badge ${displayStatus.toLowerCase().includes('unstable')? 'status-unstable':'status-rising'}">${String(displayStatus)}</span></div>
              </div>
            </div>
          </div>
        `
      }).join('') || '<div style="grid-column:1/-1;text-align:center;color:var(--muted);padding:40px">No units found</div>';

      // attach trait button handlers
      document.querySelectorAll('.trait-btn').forEach(btn => {
        btn.removeEventListener('click', onTraitClick);
        btn.addEventListener('click', onTraitClick);
      });

      // card click behaviour: in calculator mode clicking adds to calc
      document.querySelectorAll('.card').forEach(c => {
        c.removeEventListener('click', onCardClick);
        c.addEventListener('click', onCardClick);
      });

      // pagination
      renderPagination(total);
    }

    function renderPagination(total){
      if(total<=1){ pagination.innerHTML=''; return }
      let html = `<button class="page-btn" id="prev">‹</button>`;
      html += `<div style="font-weight:900;color:var(--muted);padding:6px 12px;border-radius:8px">Page ${page} / ${total}</div>`;
      html += `<button class="page-btn" id="next">›</button>`;
      pagination.innerHTML = html;
      document.getElementById('prev').onclick = ()=>{ if(page>1){ page--; render() } };
      document.getElementById('next').onclick = ()=>{ if(page<total){ page++; render() } };
    }

    // trait click handler
    function onTraitClick(e){
      e.stopPropagation();
      const btn = e.currentTarget;
      const unit = btn.getAttribute('data-unit');
      const trait = btn.getAttribute('data-trait');
      if(!unit) return;
      if(selectedTraits[unit] === trait) selectedTraits[unit] = 'base'; else selectedTraits[unit] = trait;
      render();
    }

    // card click - adds to calculator when open
    function onCardClick(e){
      const card = e.currentTarget;
      const key = card.getAttribute('data-key');
      if(!key) return;
      if(calcRoot && calcRoot.style.display === 'block'){
        const side = (prompt('Add to which side? L or R','L')||'L').toUpperCase().startsWith('R') ? 'right' : 'left';
        const qty = Math.max(1, parseInt(prompt('Quantity','1')||'1',10));
        const trait = selectedTraits[key] || 'base';
        addToCalc(side,key,qty,trait);
      }
    }

    function addToCalc(side,key,qty,trait){
      const u = unitDatabase[key]; if(!u) return;
      const traitObj = (trait && trait !== 'base' && u.traits && u.traits[trait]) ? u.traits[trait] : null;
      const single = parseValue( traitObj && traitObj.value ? traitObj.value : (u.baseStats && u.baseStats.value ? u.baseStats.value : 0) );
      const item = { id: key+':'+trait+':'+Date.now(), key, trait, qty:qty||1, single, computed: single * (qty||1) };
      if(side === 'left') leftCalc.push(item); else rightCalc.push(item);
      renderCalculator();
    }

    function renderCalculator(){
      const leftEl = document.getElementById('left-items');
      const rightEl = document.getElementById('right-items');
      leftEl.innerHTML = leftCalc.map(it=>`<div style="padding:6px 8px;background:var(--card);border-radius:8px;font-weight:900" data-id="${it.id}">${(unitDatabase[it.key] && unitDatabase[it.key].name)||it.key} x${it.qty}</div>`).join('');
      rightEl.innerHTML = rightCalc.map(it=>`<div style="padding:6px 8px;background:var(--card);border-radius:8px;font-weight:900" data-id="${it.id}">${(unitDatabase[it.key] && unitDatabase[it.key].name)||it.key} x${it.qty}</div>`).join('');
      const lsum = leftCalc.reduce((s,i)=>s+(i.computed||0),0);
      const rsum = rightCalc.reduce((s,i)=>s+(i.computed||0),0);
      document.getElementById('left-total').innerText = 'Total: '+(lsum?abbr(lsum):'0');
      document.getElementById('right-total').innerText = 'Total: '+(rsum?abbr(rsum):'0');

      // attach remove handlers
      document.querySelectorAll('#left-items [data-id]').forEach(el=>{ el.onclick = ()=>{ const id=el.getAttribute('data-id'); leftCalc = leftCalc.filter(x=>x.id!==id); renderCalculator(); }; });
      document.querySelectorAll('#right-items [data-id]').forEach(el=>{ el.onclick = ()=>{ const id=el.getAttribute('data-id'); rightCalc = rightCalc.filter(x=>x.id!==id); renderCalculator(); }; });
    }

    // init
    makeRarityButtons(); render();
    search.addEventListener('input', ()=>{ page=1; render() });

    // expose for dev
    window._fnafList = { render };
  })();
  </script>
</body>
</html>
