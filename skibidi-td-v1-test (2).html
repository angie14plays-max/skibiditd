 <!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Skibidi TD — Value List + Calculator (neon, mobile friendly, picker improvements)</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#000000;
      --card:#0f0f0f;
      --panel:#121212;
      --box:#151515;
      --border:#2f2f2f;
      --muted:#a8a8a8;
      --gold:#facc15;
      --text:#ffffff;

      /* neon gradients */
      --g-astral: linear-gradient(135deg,#7f00ff, #00ffd5);
      --g-cosmic: linear-gradient(135deg,#b800e6,#6cedf0);
      --g-divine: linear-gradient(135deg,#ff00c8,#2248ff);
      --g-godly: linear-gradient(135deg,#7b00e6,#6367ff);
      --g-exclusive: linear-gradient(135deg,#00d1ff,#4fe0a3);
      --g-mythic: linear-gradient(135deg,#ff6d68,#ffb86b);
      --g-legendary: linear-gradient(135deg,#ffd54a,#ff7a00);

      --neon-glow: 0 6px 22px rgba(255,122,200,0.06), 0 0 40px rgba(255,122,200,0.06) inset;
    }

    *{box-sizing:border-box;font-family:'Montserrat',sans-serif;-webkit-font-smoothing:antialiased}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text)}
    body{padding:18px;display:flex;flex-direction:column;align-items:center;gap:16px}

    /* debug overlay */
    #debug-overlay{display:none;position:fixed;left:0;right:0;top:0;padding:12px;background:#b91c1c;color:white;z-index:99999;text-align:center;font-family:sans-serif}

    /* Controls */
    .controls { width:100%; max-width:1200px; display:flex; flex-direction:column; gap:12px; align-items:center; }
    #search-bar { width:100%; max-width:1200px; padding:12px 16px; border-radius:14px; background:var(--card); border:2px solid var(--border); color:var(--text); outline:none; font-size:15px; }

    /* Top category buttons - bigger + neon */
    .top-buttons { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:6px; }
    .cat-btn {
      padding:12px 20px;
      border-radius:14px;
      font-weight:900;
      text-transform:uppercase;
      cursor:pointer;
      border:2px solid rgba(255,255,255,0.06);
      color:var(--text);
      background: rgba(255,255,255,0.02);
      font-size:14px;
      transition: transform .09s ease, box-shadow .12s ease, opacity .12s;
      opacity:0.95;
    }
    .cat-btn:hover { transform: translateY(-4px); box-shadow: 0 12px 36px rgba(0,0,0,0.6); }

    /* neon backgrounds for categories (dim by default) */
    .cat-btn[data-rarity="astral"] { background: var(--g-astral); filter: opacity(0.35) saturate(0.9); }
    .cat-btn[data-rarity="cosmic"] { background: var(--g-cosmic); filter: opacity(0.32); }
    .cat-btn[data-rarity="divine"] { background: var(--g-divine); filter: opacity(0.32); }
    .cat-btn[data-rarity="godly"] { background: var(--g-godly); filter: opacity(0.32); }
    .cat-btn[data-rarity="exclusive"] { background: var(--g-exclusive); filter: opacity(0.32); }
    .cat-btn[data-rarity="mythic"] { background: var(--g-mythic); filter: opacity(0.32); }
    .cat-btn[data-rarity="legendary"] { background: var(--g-legendary); filter: opacity(0.32); }
    .cat-btn[data-rarity="all"] { background: rgba(255,255,255,0.02); color:var(--muted); filter:none; }

    /* active state: full neon glow */
    .cat-btn.active { filter: none; box-shadow: 0 8px 40px rgba(255,255,255,0.06), 0 0 40px rgba(255,255,255,0.02); border-color: var(--gold); transform: translateY(-3px); outline: 3px solid rgba(255,255,255,0.02); }

    /* Sort row */
    .sort-row { display:flex; gap:10px; }
    .sort-btn { padding:8px 12px; border-radius:10px; background:var(--card); border:2px solid var(--border); color:var(--muted); font-weight:900; cursor:pointer; }

    /* Main list grid */
    .list-root { width:100%; max-width:1200px; display:grid; grid-template-columns: repeat(3, 1fr); gap:22px; margin-top:10px; padding:12px; border-radius:12px; }
    .unit-card { position:relative; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02)); border-radius:14px; padding:16px; border:2px solid var(--border); min-height:320px; display:flex; flex-direction:column; gap:10px; justify-content:space-between; overflow:hidden; }
    .unit-card > * { position:relative; z-index:2; }

    .unit-title { font-weight:900; text-transform:uppercase; text-align:center; letter-spacing:0.6px; font-size:16px; margin-bottom:6px; }

    /* circle portrait (list) */
    .portrait-circle { width:120px; height:120px; border-radius:50%; margin:0 auto; display:flex; align-items:center; justify-content:center; position:relative; background: var(--box); border:3px solid rgba(0,0,0,0.6); }
    .portrait-circle .unit-image { width:110px; height:110px; border-radius:50%; background-size:cover; background-position:center; }

    /* neon halo for portrait */
    .unit-card.rarity-astral .portrait-circle::before { content:""; position:absolute; inset:-8px; border-radius:50%; background:var(--g-astral); z-index:-1; opacity:0.98; filter: drop-shadow(0 10px 30px rgba(127,0,255,0.28)); }
    .unit-card.rarity-cosmic .portrait-circle::before { content:""; position:absolute; inset:-8px; border-radius:50%; background:var(--g-cosmic); z-index:-1; opacity:0.98; filter: drop-shadow(0 10px 30px rgba(184,0,230,0.28)); }
    .unit-card.rarity-divine .portrait-circle::before { content:""; position:absolute; inset:-8px; border-radius:50%; background:var(--g-divine); z-index:-1; opacity:0.98; filter: drop-shadow(0 10px 30px rgba(196,0,207,0.28)); }
    .unit-card.rarity-godly .portrait-circle::before { content:""; position:absolute; inset:-8px; border-radius:50%; background:var(--g-godly); z-index:-1; opacity:0.98; filter: drop-shadow(0 10px 30px rgba(123,0,230,0.28)); }
    .unit-card.rarity-exclusive .portrait-circle::before { content:""; position:absolute; inset:-8px; border-radius:50%; background:var(--g-exclusive); z-index:-1; opacity:0.98; filter: drop-shadow(0 10px 30px rgba(46,125,255,0.28)); }
    .unit-card.rarity-mythic .portrait-circle::before { content:""; position:absolute; inset:-8px; border-radius:50%; background:var(--g-mythic); z-index:-1; opacity:0.98; filter: drop-shadow(0 10px 30px rgba(255,109,104,0.28)); }
    .unit-card.rarity-legendary .portrait-circle::before { content:""; position:absolute; inset:-8px; border-radius:50%; background:var(--g-legendary); z-index:-1; opacity:0.98; filter: drop-shadow(0 10px 30px rgba(245,166,35,0.28)); }

    /* full-card glow */
    .unit-card.rarity-astral::after { content:""; position:absolute; inset:0; background:var(--g-astral); opacity:0.06; z-index:0; border-radius:12px; }
    .unit-card.rarity-cosmic::after { content:""; position:absolute; inset:0; background:var(--g-cosmic); opacity:0.06; z-index:0; border-radius:12px; }
    .unit-card.rarity-divine::after { content:""; position:absolute; inset:0; background:var(--g-divine); opacity:0.06; z-index:0; border-radius:12px; }
    .unit-card.rarity-godly::after { content:""; position:absolute; inset:0; background:var(--g-godly); opacity:0.06; z-index:0; border-radius:12px; }
    .unit-card.rarity-exclusive::after { content:""; position:absolute; inset:0; background:var(--g-exclusive); opacity:0.06; z-index:0; border-radius:12px; }
    .unit-card.rarity-mythic::after { content:""; position:absolute; inset:0; background:var(--g-mythic); opacity:0.06; z-index:0; border-radius:12px; }
    .unit-card.rarity-legendary::after { content:""; position:absolute; inset:0; background:var(--g-legendary); opacity:0.06; z-index:0; border-radius:12px; }

    .data-table { display:grid; grid-template-columns: repeat(3,1fr); gap:10px; align-items:center; }
    .data-cell { background:var(--panel); border-radius:10px; border:1px solid var(--border); padding:10px; text-align:center; min-height:64px; display:flex; flex-direction:column; justify-content:center; }
    .label { color:var(--muted); font-weight:800; font-size:11px; text-transform:uppercase; }
    .val { font-weight:900; }

    /* Status colors (persistent badges) */
    .status-badge { padding:6px 10px; border-radius:10px; font-weight:900; text-transform:uppercase; font-size:12px; display:inline-block; }
    .status-rising { background: linear-gradient(90deg,#22c55e,#7efc8a); color:#021; }
    .status-stable { background: linear-gradient(90deg,#f97316,#fbbf58); color:#1a1200; }
    .status-dropping { background: linear-gradient(90deg,#ec4899,#ff85c6); color:#25020b; }
    .status-overpaid { background: linear-gradient(90deg,#facc15,#fff2a6); color:#2b1f00; }
    .status-underpaid { background: linear-gradient(90deg,#ef4444,#ff8a8a); color:#2a0505; }
    .status-hyped { background: linear-gradient(90deg,#3b82f6,#7fd0ff); color:#03172b; }
    .status-recovering { background: linear-gradient(90deg,#9ca3af,#d1d5db); color:#061018; }
    .status-unstable { background: linear-gradient(90deg,#9d174d,#ff95c9); color:#23020a; }
    .status-high-demand { background: linear-gradient(90deg,#4c1d95,#b794f4); color:#fff; }
    .status-meme { background: linear-gradient(90deg,#06b6d4,#7ef0f7); color:#022; }
    .status-insane { background: linear-gradient(90deg,#ff3b3b,#ffb3b3); color:#200; }

    /* Demand color (small pill) - from 0 to 10 */
    .demand-pill { padding:6px 8px; border-radius:8px; font-weight:900; }
    .demand-low { background: linear-gradient(90deg,#6b7280,#9ca3af); color:#fff; }
    .demand-mid { background: linear-gradient(90deg,#f97316,#ffb86b); color:#100; }
    .demand-high { background: linear-gradient(90deg,#16a34a,#6fe89a); color:#012; }

    /* Pagination */
    .pagination { width:100%; max-width:1200px; display:flex; gap:12px; justify-content:center; align-items:center; margin:12px auto; }
    .pagination-btn { padding:8px 12px; border-radius:8px; background:var(--card); border:1px solid var(--border); color:var(--muted); font-weight:900; }

    /* Calculator */
    .calculator-root { width:100%; max-width:1200px; margin:0 auto 12px; display:none; }
    .calc-row { display:flex; gap:18px; align-items:flex-start; justify-content:center; }
    .trade-panel { width:46%; min-height:420px; border-radius:12px; padding:18px; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.01)); border:1px solid var(--border); }
    .trade-title { text-align:center; font-weight:900; text-transform:uppercase; margin-bottom:12px; }
    .plus-wrap { display:flex; justify-content:center; margin-bottom:8px; }
    .plus-btn { width:64px; height:64px; border-radius:16px; font-size:28px; font-weight:900; cursor:pointer; display:grid; place-items:center; background:var(--accent-grad); border:3px solid rgba(255,255,255,0.06); }

    .items-list { border-radius:12px; padding:16px; min-height:260px; border:1px solid rgba(255,255,255,0.04); display:grid; grid-template-columns:repeat(auto-fill,96px); gap:14px; background:rgba(0,0,0,0.01); align-items:start; }
    .calc-thumb { width:96px; height:96px; border-radius:12px; background:var(--box); border:3px solid rgba(255,255,255,0.04); position:relative; display:flex; align-items:center; justify-content:center; box-shadow: 0 8px 24px rgba(0,0,0,0.6); cursor:pointer }
    .calc-thumb .img { width:80%; height:80%; background-size:cover; background-position:center; border-radius:50%; border:3px solid rgba(0,0,0,0.6); box-shadow: var(--neon-glow); }
    .calc-thumb .thumb-remove { display:none }

    /* qty badge on top, trait label lower-left, demand pill below thumb */
    .calc-thumb .qty-badge { position:absolute; left:8px; top:8px; background:linear-gradient(90deg,#000000cc,#00000088); color:#fff; font-weight:900; padding:6px 8px; border-radius:999px; font-size:12px; min-width:28px; text-align:center; }
    .calc-thumb .trait-label { position:absolute; left:8px; bottom:8px; background:linear-gradient(90deg,#000000cc,#00000088); color:#fff; font-weight:900; padding:6px 8px; border-radius:8px; font-size:11px; text-transform:uppercase; }
    .calc-thumb .demand-pill-mini { position:absolute; left:50%; transform:translateX(-50%); bottom:-16px; padding:6px 8px; border-radius:999px; font-weight:900; font-size:11px; background:linear-gradient(90deg,#ffd54a,#ffb86b); color:#070; border:2px solid rgba(0,0,0,0.25); }

    /* when small, show unit name under the thumb in list (for accessibility) */
    .items-list .calc-thumb .name-vis { position:absolute; left:50%; transform:translateX(-50%); bottom:-18px; font-size:11px; color:var(--muted); font-weight:800; }

    /* square colored frame behind calc thumb */
    .calc-thumb.rarity-astral::before { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-astral); z-index:-1; opacity:0.95; }
    .calc-thumb.rarity-cosmic::before { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-cosmic); z-index:-1; opacity:0.95; }
    .calc-thumb.rarity-divine::before { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-divine); z-index:-1; opacity:0.95; }
    .calc-thumb.rarity-godly::before { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-godly); z-index:-1; opacity:0.95; }
    .calc-thumb.rarity-exclusive::before { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-exclusive); z-index:-1; opacity:0.95; }
    .calc-thumb.rarity-mythic::before { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-mythic); z-index:-1; opacity:0.95; }
    .calc-thumb.rarity-legendary::before { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-legendary); z-index:-1; opacity:0.95; }

    .total-box { display:flex; justify-content:center; margin-top:12px; }
    .total-value { padding:10px 16px; border-radius:10px; font-weight:900; color:#000; background: linear-gradient(90deg,#7b00e6,#ff2d6f); }

    .verdict-wrap { display:flex; justify-content:center; margin-top:12px; }
    .verdict { padding:12px 18px; border-radius:12px; background:transparent; border:1px solid rgba(255,255,255,0.03); }
    .verdict-text { font-weight:900; font-size:28px; color:#6ea0ff; text-transform:uppercase; }

    /* Picker modal - fixed frame with internal scroll. Defaults to Astral. Clicking a thumb will add and close the picker */
    .picker-overlay { position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,0.85); z-index:9999; padding:12px; }
    .picker-box { width:100%; max-width:1180px; max-height:80vh; border-radius:12px; padding:12px; display:flex; gap:12px; background:linear-gradient(180deg, rgba(255,255,255,0.006), rgba(255,255,255,0.003)); border:3px solid rgba(255,255,255,0.03); }
    .picker-sidebar { width:160px; display:flex; flex-direction:column; gap:10px; overflow:auto; padding:6px; }
    .picker-cat { padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); color:var(--muted); font-weight:900; cursor:pointer; text-transform:uppercase; text-align:left; }
    .picker-cat.active { color:#fff; border-color:var(--gold); box-shadow:0 8px 30px rgba(0,0,0,0.5) inset; }
    .picker-main { flex:1; display:flex; flex-direction:column; gap:10px; padding:6px; }
    .picker-search input { padding:10px 12px; border-radius:10px; background:var(--box); border:1px solid var(--border); color:var(--text); width:100%; }
    .picker-grid { flex:1; overflow:auto; padding:12px; display:grid; grid-template-columns: repeat(auto-fill,78px); gap:12px; border-radius:10px; }

    /* trait selector modal inside picker */
    .trait-modal { position:absolute; left:50%; top:50%; transform:translate(-50%,-50%); z-index:40; width:380px; max-width:94%; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.03)); border-radius:14px; padding:18px; box-shadow:0 18px 60px rgba(0,0,0,0.7); border:3px solid rgba(255,255,255,0.03); }
    .trait-modal .header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
    .trait-modal .title { font-weight:900; letter-spacing:1px; font-size:18px; text-transform:uppercase; }
    .trait-modal .close-x { cursor:pointer; font-weight:900; font-size:20px; padding:4px 8px; border-radius:8px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); }
    .trait-modal .traits-list { max-height:220px; overflow:auto; display:flex; flex-direction:column; gap:8px; margin-bottom:12px; }
    .trait-modal .trait-row { display:flex; gap:12px; align-items:center; justify-content:space-between; padding:10px 12px; border-radius:10px; background:var(--panel); border:1px solid var(--border); text-transform:uppercase; font-weight:900; color:var(--text); }
    .trait-modal .trait-row label { display:flex; align-items:center; gap:8px; flex:1; }
    .trait-modal .trait-row input[type="radio"] { width:16px; height:16px; accent-color:#fff; }
    .trait-modal .qty-row { display:flex; flex-direction:column; gap:6px; margin-top:4px; }
    .trait-modal .qty-row input { width:100%; padding:12px 14px; border-radius:10px; background:var(--box); border:1px solid var(--border); color:var(--muted); font-weight:900; text-transform:uppercase; }
    .trait-modal .btn-row { display:flex; gap:8px; justify-content:center; margin-top:12px; }
    .trait-modal .btn { padding:12px 18px; border-radius:10px; cursor:pointer; background:linear-gradient(90deg,#7b00e6,#ff2d6f); color:#fff; border:none; font-weight:900; width:100%; }

    .picker-thumb { width:78px; height:78px; border-radius:10px; background:var(--box); border:2px solid rgba(255,255,255,0.03); display:flex; align-items:center; justify-content:center; cursor:pointer; position:relative; }
    .picker-thumb .img { width:100%; height:100%; background-size:cover; background-position:center; border-radius:8px; }

    /* picker thumbnail colored frame */
    .picker-thumb.rarity-astral::after { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-astral); z-index:-1; opacity:0.95; }
    .picker-thumb.rarity-cosmic::after { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-cosmic); z-index:-1; opacity:0.95; }
    .picker-thumb.rarity-divine::after { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-divine); z-index:-1; opacity:0.95; }
    .picker-thumb.rarity-godly::after { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-godly); z-index:-1; opacity:0.95; }
    .picker-thumb.rarity-exclusive::after { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-exclusive); z-index:-1; opacity:0.95; }
    .picker-thumb.rarity-mythic::after { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-mythic); z-index:-1; opacity:0.95; }
    .picker-thumb.rarity-legendary::after { content:''; position:absolute; inset:-6px; border-radius:12px; background:var(--g-legendary); z-index:-1; opacity:0.95; }

    /* responsive layout: mobile-friendly */
    @media (max-width:1024px){
      .list-root { grid-template-columns:repeat(2,1fr); }
      .picker-box { flex-direction:column; max-height:90vh; }
      .picker-sidebar { width:100%; display:flex; flex-direction:row; gap:8px; overflow:auto; padding:6px; }
      .picker-cat { white-space:nowrap; padding:10px; }
    }
    @media (max-width:600px){
      .list-root { grid-template-columns:1fr; gap:12px; padding:8px; }
      .cat-btn { padding:10px 14px; font-size:13px; }
      .portrait-circle { width:96px; height:96px; }
      .portrait-circle .unit-image { width:86px; height:86px; }
      .picker-grid { grid-template-columns:repeat(auto-fill,72px); gap:10px; }
      .items-list { grid-template-columns:repeat(auto-fill,64px); gap:8px; }
    }

  </style>
</head>
<body>
  <div id="debug-overlay" role="alert" aria-live="assertive"></div>

  <div class="controls">
    <input id="search-bar" placeholder="Search unit..." aria-label="Search units" />

    <div class="top-buttons" id="top-buttons">
      <button class="cat-btn active" data-rarity="all">All</button>
      <button class="cat-btn" data-rarity="astral">Astral</button>
      <button class="cat-btn" data-rarity="cosmic">Cosmic</button>
      <button class="cat-btn" data-rarity="divine">Divine</button>
      <button class="cat-btn" data-rarity="godly">Godly</button>
      <button class="cat-btn" data-rarity="exclusive">Exclusive</button>
      <button class="cat-btn" data-rarity="mythic">Mythic</button>
      <button class="cat-btn" data-rarity="legendary">Legendary</button>
      <button class="cat-btn" data-rarity="calculator" id="calculator-tab">Calculator</button>
    </div>

    <div class="sort-row">
      <button class="sort-btn active" data-sort="default">Default Sort</button>
      <button class="sort-btn" data-sort="value-desc">High Value</button>
    </div>
  </div>

  <!-- Calculator -->
  <div id="calculator-root" class="calculator-root" aria-hidden="true" style="display:none">
    <div class="calc-row">
      <div class="trade-panel" id="left-panel" aria-label="Your value">
        <div class="trade-title you">YOUR VALUE</div>
        <div class="plus-wrap"><div class="plus-btn" id="plus-left">+</div></div>
        <div id="left-items" class="items-list" aria-live="polite"></div>
        <div class="total-box"><div id="left-total" class="total-value">TOTAL VALUE: 0</div></div>
      </div>

      <div class="trade-panel" id="right-panel" aria-label="Their value">
        <div class="trade-title them">THEIR VALUE</div>
        <div class="plus-wrap"><div class="plus-btn" id="plus-right">+</div></div>
        <div id="right-items" class="items-list" aria-live="polite"></div>
        <div class="total-box"><div id="right-total" class="total-value">TOTAL VALUE: 0</div></div>
      </div>
    </div>

    <div class="verdict-wrap"><div class="verdict"><div id="verdict-text" class="verdict-text">NO ITEMS</div></div></div>
  </div>

  <!-- Picker modal -->
  <div id="picker-overlay" class="picker-overlay" style="display:none" role="dialog" aria-modal="true">
    <div class="picker-box" role="document" aria-label="Unit picker">
      <div id="picker-sidebar" class="picker-sidebar"></div>
      <div class="picker-main">
        <div class="picker-search"><input id="picker-search-input" placeholder="SEARCH UNITS..." aria-label="Picker search" /></div>
        <div id="picker-grid" class="picker-grid"></div>
        <div id="trait-modal" class="trait-modal" style="display:none" role="dialog" aria-modal="true">
          <div class="header"><div class="title" id="trait-modal-title">ENTER QUANTITY</div><div id="trait-close" class="close-x">×</div></div>
          <div class="qty-row"><input id="trait-qty" type="number" min="1" value="1" placeholder="QUANTITY" /></div>
          <div class="traits-list" id="trait-options"></div>
          <div class="btn-row"><button id="trait-apply" class="btn">ADD</button></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main list -->
  <div id="list-root" class="list-root" aria-live="polite"></div>

  <!-- Pagination -->
  <div class="pagination" id="pagination">
    <button id="prev-btn" class="pagination-btn">Previous</button>
    <div id="page-info" class="page-info">Page 1 of 1</div>
    <button id="next-btn" class="pagination-btn">Next</button>
  </div>

  <!-- Data file (unchanged) -->
  <script src="skibidi-td-data.js"></script>

  <script>
  (function () {
    'use strict';

    // helpers
    function showFatal(msg){ console.error(msg); const d = document.getElementById('debug-overlay'); if(d){ d.style.display='block'; d.textContent = 'Fatal: ' + msg; } else alert(msg); }
    function parseValue(v){ if(v===0) return 0; if(!v && v!==0) return 0; let s = String(v).trim(); s = s.replace(/[\$\€\£\¥\₹]/g,'').replace(/\s+/g,''); const m = s.match(/^([\d,]+(?:\.\d+)?)([kKmM])?$/); if(m){ let n = parseFloat(m[1].replace(/,/g,''))||0; const sx = m[2]; if(sx){ if(sx.toLowerCase()==='k') n *= 1e3; if(sx.toLowerCase()==='m') n *= 1e6;} return n;} const f = s.match(/[\d.]+/); return f ? parseFloat(f[0].replace(/,/g,'')) : 0; }
    function abbr(n){ if(!isFinite(n)||n===0) return '0'; if(n>=1e6) return (n/1e6).toFixed(2)+'M+'; if(n>=1e3) return (n/1e3).toFixed(2)+'K'; return Math.round(n).toLocaleString(); }
    function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    if (typeof unitDatabase === 'undefined' || !unitDatabase || typeof unitDatabase !== 'object') { showFatal('unitDatabase missing.'); return; }

    const imageProvider = "https://corsproxy.io/?https://drive.google.com/thumbnail?id=";
    const unitKeys = Object.keys(unitDatabase).sort((a,b)=> (unitDatabase[a].name||'').localeCompare(unitDatabase[b].name||''));
    const LS_KEY = 'skibidi_td_trade_v2';

    // DOM refs already defined in markup via IDs
    const listRoot = document.getElementById('list-root');
    const catButtons = Array.from(document.querySelectorAll('.cat-btn'));
    const sortBtns = Array.from(document.querySelectorAll('.sort-btn'));
    const pagination = document.getElementById('pagination');
    const pageInfo = document.getElementById('page-info');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');

    const calculatorRoot = document.getElementById('calculator-root');
    const plusLeft = document.getElementById('plus-left');
    const plusRight = document.getElementById('plus-right');
    const leftItemsEl = document.getElementById('left-items');
    const rightItemsEl = document.getElementById('right-items');
    const leftTotalEl = document.getElementById('left-total');
    const rightTotalEl = document.getElementById('right-total');
    const verdictText = document.getElementById('verdict-text');

    const pickerOverlay = document.getElementById('picker-overlay');
    const pickerSidebar = document.getElementById('picker-sidebar');
    const pickerGrid = document.getElementById('picker-grid');
    const pickerSearch = document.getElementById('picker-search-input');

    // state
    let currentFilter = 'all';
    let searchQuery = '';
    let currentSort = 'default';
    let currentPage = 1;
    const itemsPerPage = 15;
    const rarityOrder = { astral:1, cosmic:2, godly:3, divine:4, mythic:5, legendary:6, exclusive:99 };

    // calculator arrays, restored from storage
    let leftItems = [], rightItems = [];

    // utility: rarity class
    function rarityClass(u){ return u && u.rarity ? 'rarity-' + String(u.rarity).toLowerCase().replace(/\s+/g,'-') : ''; }

    // STATUS mapping to badge class
    function statusClass(status){
      if(!status) return 'status-recovering';
      const s = String(status).toLowerCase();
      if (/rising|rise/.test(s)) return 'status-rising';
      if (/stable/.test(s)) return 'status-stable';
      if (/dropp|drop/.test(s)) return 'status-dropping';
      if (/overpaid/.test(s)) return 'status-overpaid';
      if (/underpaid/.test(s)) return 'status-underpaid';
      if (/hyped|hype/.test(s)) return 'status-hyped';
      if (/recovering/.test(s)) return 'status-recovering';
      if (/unstable/.test(s)) return 'status-unstable';
      if (/high demand|high demand/.test(s)) return 'status-high-demand';
      if (/meme/.test(s)) return 'status-meme';
      if (/insane/.test(s)) return 'status-insane';
      return 'status-recovering';
    }

    // demand color by numeric value
    function demandClass(demandStr){
      if(!demandStr) return 'demand-low';
      const m = String(demandStr).match(/(\d+)/);
      const v = m ? Number(m[1]) : 0;
      if (v >= 8) return 'demand-high';
      if (v >= 4) return 'demand-mid';
      return 'demand-low';
    }

    // Render main list
    function renderList(){
      const keys = unitKeys.filter(k => {
        const u = unitDatabase[k];
        const r = (u.rarity || '').toLowerCase();
        if (currentFilter !== 'all' && r !== currentFilter) return false;
        if (searchQuery && !(u.name||'').toLowerCase().includes(searchQuery.toLowerCase())) return false;
        return true;
      });

      keys.sort((a,b)=>{
        if (currentSort === 'value-desc') return parseValue(unitDatabase[b].baseStats.value) - parseValue(unitDatabase[a].baseStats.value);
        const wa = rarityOrder[(unitDatabase[a].rarity||'').toLowerCase()]||999;
        const wb = rarityOrder[(unitDatabase[b].rarity||'').toLowerCase()]||999;
        if (wa !== wb) return wa - wb;
        return (unitDatabase[a].name||'').localeCompare(unitDatabase[b].name||'');
      });

      const totalPages = Math.max(1, Math.ceil(keys.length / itemsPerPage));
      if (currentPage > totalPages) currentPage = totalPages;
      const startIndex = (currentPage - 1) * itemsPerPage;
      const pageKeys = keys.slice(startIndex, startIndex + itemsPerPage);

      pageInfo.innerText = `Page ${currentPage} of ${totalPages}`;
      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = currentPage === totalPages;

      // subtle background tint for chosen filter
      applyTintForFilter(currentFilter);

      listRoot.innerHTML = pageKeys.map(k => {
        const u = unitDatabase[k];
        const portrait = u.unitId ? `url('${imageProvider}${u.unitId}')` : '';
        const rcls = rarityClass(u);
        const stClass = statusClass(u.baseStats.status);
        const dmClass = demandClass(u.baseStats.demand);
        const second = u.secondEdition && String(u.secondEdition).toLowerCase() === 'yes' ? `<div style="color:var(--gold);font-weight:800;font-size:11px;margin-top:6px">2nd Edition</div>` : '';
        return `
          <div class="unit-card ${rcls}" data-unit="${k}">
            <div style="display:flex;flex-direction:column;align-items:center;gap:8px">
              <div class="unit-title">${esc(u.name)}</div>
              <div class="portrait-circle ${rcls}">
                <div class="unit-image" style="background-image:${portrait}"></div>
              </div>
              ${second}
            </div>

            <div class="data-table">
              <div class="data-cell">
                <div class="label">Value</div>
                <div class="val highlight-gold">${esc(u.baseStats.value)}</div>
              </div>
              <div class="data-cell">
                <div class="label">Status</div>
                <div class="val"><span class="status-badge ${stClass}">${esc(u.baseStats.status)}</span></div>
              </div>
              <div class="data-cell">
                <div class="label">Demand</div>
                <div class="val"><span class="demand-pill ${dmClass}">${esc(u.baseStats.demand)}</span></div>
              </div>
            </div>
          </div>`;
      }).join('');
    }

    function applyTintForFilter(filter){
      const map = {
        astral: 'linear-gradient(180deg, rgba(127,0,255,0.04), rgba(0,0,0,0))',
        cosmic: 'linear-gradient(180deg, rgba(184,0,230,0.04), rgba(0,0,0,0))',
        divine: 'linear-gradient(180deg, rgba(196,0,207,0.04), rgba(0,0,0,0))',
        godly: 'linear-gradient(180deg, rgba(123,0,230,0.04), rgba(0,0,0,0))',
        exclusive: 'linear-gradient(180deg, rgba(46,125,255,0.04), rgba(0,0,0,0))',
        mythic: 'linear-gradient(180deg, rgba(255,109,104,0.04), rgba(0,0,0,0))',
        legendary: 'linear-gradient(180deg, rgba(245,166,35,0.04), rgba(0,0,0,0))',
        all: 'transparent'
      };
      listRoot.style.background = map[(filter||'all')] || 'transparent';
    }

    // Picker: build categories (no "All"), default to Astral, clicking a thumb adds and auto-closes picker.
    function createPicker(){
      const cats = ['Astral','Cosmic','Divine','Godly','Exclusive','Mythic','Legendary'];
      pickerSidebar.innerHTML = cats.map(c => `<div class="picker-cat" data-cat="${c.toLowerCase()}">${c}</div>`).join('');
      // default active
      const defaultBtn = pickerSidebar.querySelector('[data-cat="astral"]');
      if (defaultBtn) defaultBtn.classList.add('active');
      renderPickerGrid('astral','',1,'astral','');

      // attach handlers
      pickerSidebar.querySelectorAll('.picker-cat').forEach(btn => {
        btn.addEventListener('click', () => {
          pickerSidebar.querySelectorAll('.picker-cat').forEach(x => x.classList.remove('active'));
          btn.classList.add('active');
          const cat = btn.getAttribute('data-cat') || 'astral';
          renderPickerGrid(cat,'',1,cat,pickerSearch.value || '');
        });
      });

      pickerSearch.removeEventListener('input', onPickerSearch);
      pickerSearch.addEventListener('input', onPickerSearch);
      // clicking overlay outside content closes picker
      pickerOverlay.addEventListener('click', (ev)=> { if (ev.target === pickerOverlay) hidePicker(); });
    }

    function onPickerSearch(e){
      const active = pickerSidebar.querySelector('.picker-cat.active');
      const cat = active ? active.getAttribute('data-cat') : 'astral';
      renderPickerGrid(cat,'',1,cat,e.target.value || '');
    }

    function renderPickerGrid(side, trait, qty, category, q){
      category = (category || 'astral').toLowerCase();
      q = (q || '').toLowerCase();

      const keys = unitKeys.filter(k => {
        const u = unitDatabase[k];
        if (!u) return false;
        if ((u.rarity || '').toLowerCase() !== category) return false;
        if (q && !(u.name || '').toLowerCase().includes(q)) return false;
        return true;
      });

      if (!keys.length) { pickerGrid.innerHTML = ''; return; }

      pickerGrid.innerHTML = keys.map(k => {
        const u = unitDatabase[k];
        const p = u.unitId ? `url('${imageProvider}${u.unitId}')` : '';
        const rcls = (u.rarity || '').toLowerCase().replace(/\s+/g,'-');
        // NOTE: no dragging; clicking will add and auto-close
        return `<div class="picker-thumb rarity-${rcls}" data-key="${k}" title="${esc(u.name)}"><div class="img" style="background-image:${p}"></div></div>`;
      }).join('');

      // click handlers: add and close picker
      pickerGrid.querySelectorAll('.picker-thumb').forEach(t => {
        t.removeEventListener('click', onPickerClick);
        t.addEventListener('click', onPickerClick);
      });
    }

    function onPickerClick(e){
      const key = e.currentTarget.getAttribute('data-key');
      if (!key) return;
      // open trait/quantity modal to allow picking trait and quantity
      showTraitModal(key);
    }

    function showPicker(){ pickerOverlay.style.display = 'flex'; document.body.style.overflow = 'hidden'; }
    function hidePicker(){ pickerOverlay.style.display = 'none'; document.body.style.overflow = ''; }

    // Trait modal logic
    let _currentTraitKey = null;
    const traitModal = document.getElementById('trait-modal');
    const traitOptions = document.getElementById('trait-options');
    const traitQty = document.getElementById('trait-qty');
    const traitTitle = document.getElementById('trait-modal-title');
    const traitApplyBtn = document.getElementById('trait-apply');
    const traitCloseBtn = document.getElementById('trait-close');

    // traitIcons map lets you associate a trait name with a drive thumbnail id (test mapping included)
    const traitIcons = {
      // example mapping from user: Superpayday -> drive id snippet
      'Superpayday': '1fskkP2TO22EJ9PVhr8f7IKqzvN6DD0c-'
    };

    function showTraitModal(key){
      const u = unitDatabase[key];
      if (!u) return;
      _currentTraitKey = key;
      // title shows unit name for clarity
      traitTitle.textContent = (u.name || 'Unit').toUpperCase();
      traitOptions.innerHTML = '';
      // base option (icon if traitIcons provides one keyed by 'base' or use unit image)
      const baseVal = esc(u.baseStats && u.baseStats.value ? u.baseStats.value : '0');
      const baseIconId = u.unitId || traitIcons['Base'] || null;
      const baseIcon = baseIconId ? `<div class="trait-icon" style="background-image:url('${imageProvider}${baseIconId}')"></div>` : '';
      const baseRow = document.createElement('div'); baseRow.className = 'trait-row';
      baseRow.innerHTML = `${baseIcon}<div style="flex:1">BASE — ${baseVal}</div><input type=\"radio\" name=\"trait-choice\" value=\"base\" checked />`;
      traitOptions.appendChild(baseRow);

      // trait options if available: add icon for each trait when mapping exists
      if (u.traits && typeof u.traits === 'object'){
        Object.keys(u.traits).forEach(tk => {
          const t = u.traits[tk];
          const tv = esc(t && t.value ? t.value : 'N/A');
          const iconId = traitIcons[tk] || t.icon || null;
          const iconHtml = iconId ? `<div class="trait-icon" style="background-image:url('${imageProvider}${iconId}')"></div>` : '';
          const r = document.createElement('div'); r.className = 'trait-row';
          r.innerHTML = `${iconHtml}<div style="flex:1">${esc(tk)} — ${tv}</div><input type=\"radio\" name=\"trait-choice\" value=\"${esc(tk)}\" />`;
          traitOptions.appendChild(r);
        });
      }
      traitQty.value = 1;
      traitModal.style.display = 'block';
    }

    function hideTraitModal(){
      _currentTraitKey = null;
      traitModal.style.display = 'none';
    }

    function onTraitApply(){
      if (!_currentTraitKey) { hideTraitModal(); return; }
      const chosen = (traitOptions.querySelector('input[name="trait-choice"]:checked') || {}).value || 'base';
      let qty = parseInt(traitQty.value, 10) || 1; if (qty < 1) qty = 1;
      const side = currentPickerSide || 'left';
      addToSide(side, _currentTraitKey, chosen, qty);
      hideTraitModal();
      hidePicker();
    }

    traitApplyBtn.removeEventListener && traitApplyBtn.removeEventListener('click', onTraitApply);
    traitApplyBtn.addEventListener('click', onTraitApply);
    traitCloseBtn && traitCloseBtn.addEventListener('click', hideTraitModal);

    // calculator rendering functions
    function calcThumbHTML(it){
      const u = unitDatabase[it.key] || {};
      const p = u.unitId ? `url('${imageProvider}${u.unitId}')` : '';
      const rcls = (u.rarity || '').toLowerCase().replace(/\s+/g,'-');
      const qtyHtml = `<div class="qty-badge">${it.qty || 1}</div>`;
      const traitLabel = (it.trait && it.trait !== 'base') ? `<div class="trait-label">${esc(String(it.trait).toUpperCase())}</div>` : '';
      const demandText = u.baseStats && u.baseStats.demand ? `DEMAND: ${esc(u.baseStats.demand)}` : '';
      const demandHtml = demandText ? `<div class="demand-pill-mini">${demandText}</div>` : '';
      // add optional visible name under thumb when placed in list (for clarity)
      const nameVis = `<div class="name-vis">${esc(u.name)}</div>`;
      return `<div class="calc-thumb rarity-${rcls}" data-id="${it.id}" title="${esc(u.name)}"><div class="img" style="background-image:${p}"></div><div class="thumb-remove" data-id="${it.id}">×</div>${qtyHtml}${traitLabel}${demandHtml}${nameVis}</div>`;
    }

    function onCalcThumbClick(e){
      const el = e.currentTarget;
      const id = el.getAttribute('data-id');
      if(!id) return;
      // remove from left or right arrays
      let idx = leftItems.findIndex(x => x.id === id);
      if (idx >= 0) leftItems.splice(idx,1);
      else { idx = rightItems.findIndex(x => x.id === id); if (idx >= 0) rightItems.splice(idx,1); }
      persistTrade(); renderThumbs(); updateTotalsAndVerdict();
    }

    function renderThumbs(){
      leftItemsEl.innerHTML = leftItems.map(calcThumbHTML).join('');
      rightItemsEl.innerHTML = rightItems.map(calcThumbHTML).join('');
      // attach click-to-remove handlers on the whole thumb
      document.querySelectorAll('.calc-thumb').forEach(el=>{
        el.removeEventListener('click', onCalcThumbClick);
        el.addEventListener('click', onCalcThumbClick);
      });
      // ensure totals update after rendering
      updateTotalsAndVerdict();
    }

    function onThumbRemove(e){
      const id = e.currentTarget.getAttribute('data-id');
      let idx = leftItems.findIndex(x => x.id === id);
      if (idx >= 0) leftItems.splice(idx,1);
      idx = rightItems.findIndex(x => x.id === id);
      if (idx >= 0) rightItems.splice(idx,1);
      persistTrade();
      renderThumbs();
      updateTotalsAndVerdict();
    }

    function addToSide(side, key, trait, qty){
      if (!key || !unitDatabase[key]) return;
      qty = Math.max(1, Math.floor(qty) || 1);
      const u = unitDatabase[key];
      const single = (trait && trait !== 'base' && u.traits && u.traits[trait]) ? parseValue(u.traits[trait].value) : parseValue(u.baseStats.value);
      const item = { id: `${key}:${trait}:${Date.now()}:${Math.random().toString(36).slice(2,6)}`, key, trait, qty, single, computed: single * qty };
      if (side === 'left') leftItems.push(item); else rightItems.push(item);
      persistTrade();
      renderThumbs();
      updateTotalsAndVerdict();
    }

    function updateTotalsAndVerdict(){
      leftItems.forEach(i => i.computed = (i.single||0) * (i.qty||1));
      rightItems.forEach(i => i.computed = (i.single||0) * (i.qty||1));
      const leftSum = leftItems.reduce((s,i)=>s+Number(i.computed||0),0);
      const rightSum = rightItems.reduce((s,i)=>s+Number(i.computed||0),0);
      leftTotalEl.innerText = `TOTAL VALUE: ${abbr(leftSum)}`;
      rightTotalEl.innerText = `TOTAL VALUE: ${abbr(rightSum)}`;
      const FAIR = 0.02, SMALL = 0.10;
      let verdict = 'NO ITEMS';
      if (leftSum === 0 && rightSum === 0) verdict = 'NO ITEMS';
      else if (Math.abs(leftSum - rightSum) <= Math.max(1, FAIR * Math.max(leftSum, rightSum))) verdict = 'FAIR';
      else if (leftSum > rightSum) { if (rightSum === 0 || leftSum > rightSum * (1 + SMALL)) verdict = 'OVERPAYING'; else verdict = 'LOSE'; }
      else { if (leftSum === 0 || rightSum > leftSum * (1 + SMALL)) verdict = 'UNDERPAYING'; else verdict = 'WIN'; }
      verdictText.innerText = verdict.toUpperCase();
    }

    // persistence
    function persistTrade(){
      try {
        const payload = { left: leftItems.map(i => ({ key:i.key, trait:i.trait, qty:i.qty })), right: rightItems.map(i => ({ key:i.key, trait:i.trait, qty:i.qty })) };
        localStorage.setItem(LS_KEY, JSON.stringify(payload));
      } catch (err) { console.warn('persistTrade failed', err); }
    }
    function restoreTrade(){
      try {
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return;
        const parsed = JSON.parse(raw);
        if (parsed && parsed.left && parsed.right) {
          leftItems = parsed.left.map(it => {
            const single = (it.trait && it.trait !== 'base' && unitDatabase[it.key] && unitDatabase[it.key].traits && unitDatabase[it.key].traits[it.trait]) ? parseValue(unitDatabase[it.key].traits[it.trait].value) : parseValue((unitDatabase[it.key] && unitDatabase[it.key].baseStats && unitDatabase[it.key].baseStats.value) || 0);
            return { id: `${it.key}:${it.trait}:${Date.now()}:${Math.random().toString(36).slice(2,6)}`, key:it.key, trait:it.trait, qty: Math.max(1, it.qty||1), single, computed: single * Math.max(1, it.qty||1) };
          });
          rightItems = parsed.right.map(it => {
            const single = (it.trait && it.trait !== 'base' && unitDatabase[it.key] && unitDatabase[it.key].traits && unitDatabase[it.key].traits[it.trait]) ? parseValue(unitDatabase[it.key].traits[it.trait].value) : parseValue((unitDatabase[it.key] && unitDatabase[it.key].baseStats && unitDatabase[it.key].baseStats.value) || 0);
            return { id: `${it.key}:${it.trait}:${Date.now()}:${Math.random().toString(36).slice(2,6)}`, key:it.key, trait:it.trait, qty: Math.max(1, it.qty||1), single, computed: single * Math.max(1, it.qty||1) };
          });
        }
      } catch (err) { console.warn('restoreTrade failed', err); }
    }

    // top category button wiring (single row)
    catButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        catButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const rval = btn.getAttribute('data-rarity') || 'all';
        if (rval === 'calculator') {
          // show calculator, hide list & pagination
          calculatorRoot.style.display = 'block';
          calculatorRoot.setAttribute('aria-hidden', 'false');
          listRoot.style.display = 'none';
          pagination.style.display = 'none';
        } else {
          // switching away from calculator should clear selected items
          leftItems = [];
          rightItems = [];
          persistTrade();
          renderThumbs();
          updateTotalsAndVerdict();
          calculatorRoot.style.display = 'none';
          calculatorRoot.setAttribute('aria-hidden', 'true');
          listRoot.style.display = '';
          pagination.style.display = 'flex';
          currentFilter = rval;
          currentPage = 1;
          renderList();
        }
      });
    });

    // sort buttons
    sortBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        sortBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentSort = btn.getAttribute('data-sort') || 'default';
        currentPage = 1; renderList();
      });
    });

    // pagination wiring
    prevBtn.addEventListener('click', ()=>{ if (currentPage>1){ currentPage--; renderList(); window.scrollTo({top:0,behavior:'smooth'}); } });
    nextBtn.addEventListener('click', ()=> {
      const keys = unitKeys.filter(k => {
        const u = unitDatabase[k];
        const r = (u.rarity || '').toLowerCase();
        if (currentFilter !== 'all' && r !== currentFilter) return false;
        if (searchQuery && !(u.name||'').toLowerCase().includes(searchQuery.toLowerCase())) return false;
        return true;
      });
      const maxPage = Math.ceil(keys.length / itemsPerPage) || 1;
      if (currentPage < maxPage) { currentPage++; renderList(); window.scrollTo({top:0,behavior:'smooth'}); }
    });

    // search bar
    document.getElementById('search-bar').addEventListener('input', (e)=>{ searchQuery = e.target.value || ''; currentPage = 1; renderList(); });

    // picker open buttons (open modal default to Astral)
    let currentPickerSide = 'left';
    plusLeft.addEventListener('click', ()=> { currentPickerSide = 'left'; createPicker(); showPicker(); });
    plusRight.addEventListener('click', ()=> { currentPickerSide = 'right'; createPicker(); showPicker(); });

    // phone & modal: ensure scrolling inside picker - we've set CSS max-height and overflow.

    // initialization
    try {
      restoreTrade();
      renderList();
      renderThumbs();
      updateTotalsAndVerdict();
    } catch (err) {
      showFatal('Initialization error: ' + (err && err.message ? err.message : String(err)));
    }

    // expose for debugging
    window._skibidi = { unitDatabase, leftItems, rightItems, renderList, renderThumbs, updateTotalsAndVerdict };

  })();
  </script>
</body>
</html>
